pipeline {
    agent { label 'jdk11' }
    options {
        timeout( time: 1, unit: 'Hours')
        retry(2)
    }
    Triggers {
        cron ( '0 * * * *' )
    }

    stages {
        stage( 'source code' )
        steps {
            git url: 'https://github.com/spring-projects/spring-petclinic.git',
            branch: 'main'
        }
    }
    stage( 'Build the code and sonarqube-analysis ')
    steps {
        withSonarQubeEnv( 'SONAR_LATEST') {
            sh script: "mvn clean package sonar:sonar"
        }
    }
    stage( 'reporting')
    steps {
        junit testResults: 'target/surefire-reports/*.xml'
    }
    stage( 'archive the artifactory' )
    steps {
        Archive Artifacts: '**/*.war'
    } 
}
   